language: php
sudo: false
dist: trusty

addons:
  apt:
    update: true
    packages:
      - python-sphinx
      - python-babel
      - doxygen
      - graphviz
      - texlive-latex-base
      - texlive-latex-recommended
      - texlive-latex-extra
      - texlive-fonts-recommended
      - texlive-lang-french
      - texlive-lang-english

notifications:
  email: false

php:
  - 7

script:
  - rm composer.lock
  - composer self-update -n
  - composer install -n
  - export COMMIT_DESC=`git describe --exact 2>/dev/null || git rev-parse --abbrev-ref HEAD`
  - cd docs/src/ && for lang in fr en; do for builder in html latex; do sphinx-build -T -E -b $builder -d ../_build/doctrees -D language=$lang . "../enduser/$builder/$lang/$COMMIT_DESC"; done; make -C ../enduser/latex/$lang/$COMMIT_DESC all-pdf < /dev/null; done

deploy:
  local-dir: docs/enduser/
  provider: pages
  #repo: Erebot/erebot.github.io
  skip-cleanup: true
  github-token: $GITHUB_TOKEN
  keep-history: true
  verbose: true
  on:
    branch: master
